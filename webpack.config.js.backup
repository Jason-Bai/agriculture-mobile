const path = require('path');

const merge = require('webpack-merge');

const validate = require('webpack-validator');

var parts = require('./libs/webpack/parts');

const PATHS = {
    src: 'src',
    release: 'release'
};

const common = {
    entry: {
        Index: path.join(__dirname, PATHS.src + '/modules/app/home/index.js'),
        List: path.join(__dirname, PATHS.src + '/modules/app/list/index.js'),
        Detail: path.join(__dirname, PATHS.src + '/modules/app/detail/index.js')
    },
    output: {
        path: path.join(__dirname, 'release'), // This is where images & js will go
        //publicPath: 'http://xxx.com/webpack-demo/', // This is used to generate URLs to e.g. images
        publicPath: '../', // This is used to generate URLs to e.g. images
        filename: '[name].js',
        chunkFilename: "[id].chunk.js?[hash:8]"
    }
};

var config;

switch (process.env.npm_lifecycle_event) {
    case 'build':
        config = merge(
            common,
            parts.setupLoaders(PATHS.app),
            parts.setUpPlugins()
        );
        break;
    default:
        config = merge(
            common,
            {
                devtool: 'eval-source-map'
            },
            parts.setupLoaders(PATHS.app),
            parts.setUpResolve(),
            parts.setUpPlugins(),
            parts.devServer({
                host: process.env.HOST,
                port: process.env.PORT
            })
        );
}

module.exports = validate(config);
